{% extends "base2.html" %}

{% block content %}
    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <h1>Our Products</h1>
                    <p>Premium construction materials for every project</p>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/">Home</a></li>
                            <li class="breadcrumb-item active">Products</li>
                            <li class="breadcrumb-item active"> {% if selected_category %}
                                {% for category in categories %}
                                    {% if category.id == selected_category %}
                                        {{ category.name }}
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                All Categories
                            {% endif %}</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </section>

    <!-- Filters Section -->
    <section class="filters-section">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="filters-bar ">
                        <div class="filter-group me-3 d-flex justify-content-center">
                           
                            <div class="dropdown">
                                <button class="btn btn-outline-primary dropdown-toggle btn-add-cart" type="button" id="categoryDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                    {% if selected_category %}
                                        {% for category in categories %}
                                            {% if category.id == selected_category %}
                                                {{ category.name }}
                                            {% endif %}
                                        {% endfor %}
                                    {% else %}
                                        All Categories
                                    {% endif %}
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="categoryDropdown">
                                    <li>
                                        <form method="GET" action="{{ url_for('views.products', page=1) }}">
                                            <input type="hidden" name="category" value="all">
                                            <button type="submit" class="dropdown-item {% if not selected_category %}active{% endif %}">All Categories</button>
                                        </form>
                                    </li>
                                    {% for category in categories %}
                                    <li>
                                        <form method="GET" action="{{ url_for('views.products', page=1) }}">
                                            <input type="hidden" name="category" value="{{ category.id }}">
                                            <button type="submit" class="dropdown-item {% if selected_category == category.id %}active{% endif %}">{{ category.name }}</button>
                                        </form>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                      
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Products Grid -->
    <section class="products-grid">
        <div class="container">
            <div class="row" id="productsContainer">
                {% for product in products %}
                <div class="col-lg-4 col-md-6 mb-4 product-item" data-category="{{ product.category_id }}">
                    <div class="product-card-shop">
                        <div class="product-image-shop">
                            {% if product.images %}
                                <img src="{{ url_for('static', filename='uploads/' + product.images[0].image) }}" alt="{{ product.name }}" class="img-fluid">
                            {% else %}
                                <!-- Placeholder if no image -->
                                <div class="no-image-placeholder">No Image</div>
                            {% endif %}
                            <div class="product-overlay">
                                <a href="{{ url_for('views.product_single', product_id=product.id) }}" class="btn-view">
                                    <i class="fas fa-eye"></i>
                                </a>
                            </div>
                        </div>
                        <div class="product-info">
                            <h5>{{ product.name }}</h5>
                            <p class="product-description">{{ product.description|truncate(100) }}</p>
                            <div class="product-price">
                               <!--  <span class="current-price">${{ "%.2f"|format(product.price) }}</span> -->
                            </div>
                            <!--
                            <button class="btn btn-primary btn-add-cart" onclick="addToCart('{{ product.id }}', '{{ product.name }}', {{ product.price }})">
                                <i class="fas fa-shopping-cart me-2"></i>Add to Cart
                            </button>
                            -->
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="col-12">
                    <p class="text-center">No products found in this category.</p>
                </div>
                {% endfor %}
            </div>
            
            <!-- Pagination -->
            {% if pagination %}
            <div class="row">
                <div class="col-12">
                    <nav aria-label="Page navigation">
                        <ul class="pagination justify-content-center">
                            {% if pagination.has_prev %}
                            <li class="page-item">
                                <a class="page-link" href="{{ url_for('views.products', page=pagination.prev_num, category=selected_category or 'all') }}">Previous</a>
                            </li>
                            {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">Previous</span>
                            </li>
                            {% endif %}
                            
                            {% for page_num in pagination.iter_pages() %}
                            {% if page_num %}
                                {% if page_num == pagination.page %}
                                <li class="page-item active">
                                    <span class="page-link">{{ page_num }}</span>
                                </li>
                                {% else %}
                                <li class="page-item">
                                    <a class="page-link" href="{{ url_for('views.products', page=page_num, category=selected_category or 'all') }}">{{ page_num }}</a>
                                </li>
                                {% endif %}
                            {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                            {% endif %}
                            {% endfor %}
                            
                            {% if pagination.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="{{ url_for('views.products', page=pagination.next_num, category=selected_category or 'all') }}">Next</a>
                            </li>
                            {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">Next</span>
                            </li>
                            {% endif %}
                        </ul>
                    </nav>
                </div>
            </div>
            {% endif %}
        </div>
    </section>
{% endblock %}